# WhisperLiveKit Windows 启动脚本使用说明

## 📋 脚本总览

本项目提供了多个Windows启动脚本，满足不同用户的使用需求：

| 脚本文件 | 类型 | 适用场景 | 特点 |
|---------|------|----------|------|
| `start_whisperlivekit.bat` | 批处理 | 简单快速启动 | 双击即用，自动检测环境 |
| `Start-WhisperLiveKit.ps1` | PowerShell | 参数化启动 | 支持命令行参数 |
| `WhisperLiveKit-Manager.ps1` | PowerShell | 完整管理 | 启动/停止/状态/安装等 |
| `config.txt` | 配置文件 | 参数配置 | 自定义默认设置 |

## 🚀 快速开始

### 方法1: 双击启动（推荐新手）
1. 双击 `start_whisperlivekit.bat`
2. 脚本会自动检测和安装依赖
3. 服务启动后访问 http://localhost:8815

### 方法2: PowerShell启动（推荐高级用户）
```powershell
# 基础启动
.\Start-WhisperLiveKit.ps1

# 使用中等模型
.\Start-WhisperLiveKit.ps1 -Model medium

# 中文语音转录 + GPU加速
.\Start-WhisperLiveKit.ps1 -Language zh -GPU

# 启用说话人分离
.\Start-WhisperLiveKit.ps1 -Diarization
```

### 方法3: 完整管理（推荐开发者）
```powershell
# 查看帮助
.\WhisperLiveKit-Manager.ps1 help

# 安装依赖
.\WhisperLiveKit-Manager.ps1 install

# 启动服务
.\WhisperLiveKit-Manager.ps1 start

# 检查状态
.\WhisperLiveKit-Manager.ps1 status

# 停止服务
.\WhisperLiveKit-Manager.ps1 stop

# 重启服务
.\WhisperLiveKit-Manager.ps1 restart
```

## ⚙️ 配置说明

### config.txt 配置文件
编辑 `config.txt` 可以设置默认参数：

```ini
# 服务器配置
HOST=0.0.0.0          # 绑定所有网络接口
PORT=8815              # 服务端口

# 模型配置
MODEL=tiny             # 模型大小：tiny/base/small/medium/large
LANGUAGE=auto          # 语言：auto/zh/en/ja/ko等

# 高级功能（去掉#启用）
# DIARIZATION=true     # 说话人分离
# GPU=true             # GPU加速
# CONFIDENCE_VALIDATION=true  # 置信度验证
```

### 模型大小对比

| 模型 | 大小 | 内存占用 | 速度 | 质量 | 推荐用途 |
|------|------|----------|------|------|----------|
| tiny | ~39MB | ~1GB | 最快 | 一般 | 测试/演示 |
| base | ~74MB | ~1GB | 快 | 好 | 日常使用 |
| small | ~244MB | ~2GB | 中等 | 很好 | 平衡性能 |
| medium | ~769MB | ~5GB | 慢 | 优秀 | 高质量转录 |
| large | ~1550MB | ~10GB | 最慢 | 最佳 | 专业应用 |

## 🔧 常见问题

### Q: 脚本无法运行？
**A:** 确保：
1. 在项目根目录运行（包含pyproject.toml文件）
2. Python已安装并添加到PATH
3. PowerShell执行策略允许脚本运行：
   ```powershell
   Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser
   ```

### Q: 启动很慢或失败？
**A:** 可能原因：
1. 首次启动需要下载模型，请耐心等待
2. 网络问题，脚本已配置清华源加速
3. 端口被占用，修改config.txt中的PORT设置

### Q: GPU加速无效？
**A:** 检查：
1. 显卡支持CUDA
2. 安装了对应版本的CUDA驱动
3. 运行：`python -c "import torch; print(torch.cuda.is_available())"`

### Q: 中文转录效果不好？
**A:** 建议：
1. 使用 `-Language zh` 指定中文
2. 选择更大的模型如 `medium` 或 `large`
3. 确保音频质量清晰

### Q: 如何在后台运行？
**A:** PowerShell方式：
```powershell
Start-Process powershell -ArgumentList ".\Start-WhisperLiveKit.ps1" -WindowStyle Hidden
```

## 🌐 访问方式

服务启动后可通过以下方式访问：

| 访问方式 | URL | 说明 |
|----------|-----|------|
| 本地访问 | http://localhost:8815 | 仅本机可访问 |
| 局域网访问 | http://[IP]:8815 | 同网络设备可访问 |
| API文档 | http://localhost:8815/docs | Swagger API文档 |
| WebSocket | ws://localhost:8815/ws | 实时音频流 |

## 📝 日志和调试

### 查看详细日志
```powershell
.\Start-WhisperLiveKit.ps1 -Model tiny | Tee-Object -FilePath "whisper.log"
```

### 调试模式
修改config.txt：
```ini
LOG_LEVEL=DEBUG
```

## 🔄 更新和维护

### 更新到最新版本
```powershell
# 使用管理脚本
.\WhisperLiveKit-Manager.ps1 update

# 手动更新
pip install -U -e . -i https://pypi.tuna.tsinghua.edu.cn/simple
```

### 清理缓存
```powershell
# 清理pip缓存
pip cache purge

# 清理模型缓存
Remove-Item -Recurse -Force "$env:USERPROFILE\.cache\torch\hub"
```

## 🎯 使用建议

1. **首次使用**：建议使用tiny模型测试，确保环境正常
2. **生产环境**：推荐使用small或medium模型平衡性能和质量
3. **网络环境**：脚本已配置国内镜像源，加速下载
4. **资源监控**：大模型消耗内存较多，注意系统资源
5. **安全考虑**：如需外网访问，注意防火墙和安全设置

## 📞 获取帮助

- 项目文档：查看README.md
- 问题报告：GitHub Issues
- 脚本帮助：运行 `.\WhisperLiveKit-Manager.ps1 help`